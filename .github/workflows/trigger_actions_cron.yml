name: Sample Run Include Syntax Json Format
on:
  schedule:
    - cron: '0/5 * * * *'
jobs:
  job1:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.setmatrix.outputs.matrix }}
    steps:
      - uses: actions/checkout@v2
      - name: List all pull requests and Set Dynamic Matrix4
        id: listprs
        uses: JBWere-Dev-Team/list-pull-requests@v1
        with:
          token: ${{secrets.GITHUB_TOKEN}}
      - name: output
        id: setmatrix
        run: |
          matrixStringifiedObject="{\"include\": ${{ toJson(steps.listprs.outputs.prs) }}}"
          echo "::set-output name=matrix::$matrixStringifiedObject"

  job2:
    needs: job1
    runs-on: ubuntu-latest
    strategy:
      matrix: ${{ fromJson(needs.job1.outputs.matrix) }}
    steps:
      - run: echo Run11 ${{ matrix.slugref }} ${{ matrix.ref }} ${{ matrix.url }}
      - uses: convictional/trigger-workflow-and-wait@v1.3.0
        with:
           owner: michaelm-clearpoint
           repo: github-actions-strategy-matrix-example
           github_token: ${{ secrets.PERSONAL_ACCESS_TOKEN  }}
           workflow_file_name: pr_action.yml
           ref: ${{ matrix.ref }}
           wait_interval: 10
           inputs: "{\"slugref\":\"${{ matrix.slugref }}\"}"
           propagate_failure: false
           trigger_workflow: true
           wait_workflow: true

